# Netlab C9s (Multus) E2E Notes — 2026-01-18

This note captures the minimal set of changes/images needed to get a full Netlab→Clabernetes E2E working with Arista cEOS when using `connectivity: multus` and `native mode`.

## What was failing

- Clabernetes manager failed reconciling Multus NADs with `Object 'Kind' is missing in 'unstructured object has no kind'`.
- After fixing that, RBAC blocked NAD listing (`network-attachment-definitions.k8s.cni.cncf.io is forbidden`).
- Showsystemd-based nodes (cEOS) crashed in native mode when `shareProcessNamespace: true` (systemd not PID 1).
- Launcher crashed on `multus` because it only supported `vxlan` + `slurpeeth` connectivity managers.
- Linux “host” nodes based on `python:*` images exited immediately in Kubernetes; topology never reached Ready.
- Post-up config is Go-only; Linux scripts run in-pod and network OS uses startup configs. No Ansible runner is required.
- Arista cEOS SSH was not enabled by default for post-deploy validation/automation.

## Current working images (prod/qa)

- `ghcr.io/forwardnetworks/skyforge-server:20260118-sshfix-3b53fce`
  - Includes Skyforge-side injection of `management ssh` into cEOS startup-config for netlab-c9s.
- `ghcr.io/forwardnetworks/skyforge-clabernetes-manager:20260118-linuxcmd-e2df169`
  - Includes:
    - Proper Unstructured list GVK setup for NAD List.
    - Node readiness fallback based on Pod Ready condition (Deployment status counters can be missing).
    - In native mode:
      - Disable `shareProcessNamespace` for `ceos/eos` nodes (systemd must be PID 1).
      - Force linux/python/alpine nodes to run `sh -c "sleep infinity"` so they stay alive.
- `ghcr.io/forwardnetworks/skyforge-clabernetes-launcher:20260118-multus-noop-7bca066`
  - Includes no-op connectivity manager for `multus` (no tunnel process needed).
## Helm chart requirements

- Clabernetes manager RBAC must include NAD permissions:
  - API group: `k8s.cni.cncf.io`
  - Resource: `network-attachment-definitions`
  - Verbs: `get,list,create,update,delete,patch,watch`

## Notes

- We still skip `/etc/hosts` bind mounts for linux nodes (clabernetes runtime limitation); this shows as warnings but does not block E2E.
- The upstream clabernetes repo remote is not writable from this environment; the patches were applied locally to `~/Projects/skyforge/clabernetes` and shipped via GHCR images.
